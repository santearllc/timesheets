<div *ngIf="approval_vars.showPopup_reject" id="rejected_note_popup" class="popup">
    <div>
        <div class="popup_title">Confirm Rejection</div>
        <div style="font-style:italic;font-size:0.8em;margin-top:10px;">Note will be emailed to artist &amp; posted to time sheet to assist in correction.</div>
        <div class="popup_text"><textarea style="width:100%;resize:none;height:100px;" (keyup)="updateNote($event,'artist')" placeholder="For Artist"></textarea></div>
        <div style="font-style:italic;font-size:0.8em;">Note will be emailed to department lead. It is NOT VISIBLE to artist.</div>
        <div class="popup_text"><textarea style="width:100%;resize:none;height:100px;" (keyup)="updateNote($event, 'supervisor')" placeholder="For Department"></textarea></div>        
        <div class="popup_buttons">
            <button (click)="rowRejected($event)">Reject</button>
            <button (click)="approval_vars.showPopup_reject = false;">Cancel</button>
        </div>
    </div>
</div>

<div *ngIf="approval_vars.showPopup_unapproval" class="popup" id="confirm_unapproval_popup">
    <div>
        <div class="popup_title">Confirm Unapproval</div>
        <div class="popup_text">Are you sure you want to unapprove this time sheet row?</div>
        <div class="popup_buttons">
            <button (click)="unapprovalConfirmed($event)">Confirm</button>
            <button (click)="closePopup($event)">Cancel</button>
        </div>
    </div>
</div>

<div class="debug_settings" *ngIf="false">
    <div onClick="$(this).next().toggle()" style="cursor:pointer;">Testing Info</div>
    <div style="font-size:0.8em;">OT indicator is not fully implemented</div>
    <div class="debug_items" style="display:none;">
        <div class="alt_btn" (click)="(current_office==1) ? current_office=0 : current_office=1;updateTimeSheetTotals();">Toggle Location: {{ (current_office == 1) ? 'CAN' : 'US'}}</div>
        <div class="alt_btn" (click)="loadInitSheet()">Clear Timesheet (reset)</div>
        <div class="alt_btn" (click)="timesheetToLines()" *ngIf="false">TimeSheet to Lines</div>
        <div class="alt_btn" (click)="loadSampleTimeSheet()">Load Sample Time Sheet</div>
    </div>
</div>
<div style="margin-bottom: 10px;margin-top:20px;">
    <div class="alt_btn" style="display:inline-block;" (click)="(approval_vars.showCal) ? approval_vars.showCal = false : approval_vars.showCal = true;">{{approval_date}}</div>
    <div *ngIf="save_status" style="float:right;color:#555;" (click)="saveTimeSheet()">
        {{save_status}}
        <svg height="10" width="10">
            <circle cx="5" cy="5" r="5" stroke="black" stroke-width="3" [attr.fill]="save_status_color" />
        </svg>
    </div>

    <!-- This static calendar will be replaced with a script generated one  <app-calendar></app-calendar> -->
    <div id="cal" *ngIf="approval_vars.showCal">
        <div style="padding-bottom:5px;margin-bottom:10px;border-bottom:1px #DDD solid;">
            <table width="100%;">
                <tr>
                    <td>&larr;</td>
                    <td style="text-align:center;">December 2015</td>
                    <td>&rarr;</td>
                </tr>
            </table>
        </div>
        <table class="cal_weeks" width="100%;">
            <tr class="disable-clicks">
                <td *ngFor="let day_i of days_label" style="font-weight:700;">{{ day_i }}</td>
            </tr>
            <tr (click)="weekSelected(0)">
                <td class="cal_dif_mo">27</td>
                <td class="cal_dif_mo">28</td>
                <td class="cal_dif_mo">29</td>
                <td class="cal_dif_mo">30</td>
                <td>1</td>
                <td>2</td>
                <td>3</td>
            </tr>
            <tr class="cal_days" (click)="weekSelected(1)">
                <td>4</td>
                <td>5</td>
                <td>6</td>
                <td>7</td>
                <td>8</td>
                <td>9</td>
                <td>10</td>
            </tr>
            <tr (click)="weekSelected(2)">
                <td>11</td>
                <td>12</td>
                <td>13</td>
                <td>14</td>
                <td>15</td>
                <td>16</td>
                <td>17</td>
            </tr>
            <tr (click)="weekSelected(3)">
                <td>18</td>
                <td>19</td>
                <td>20</td>
                <td>21</td>
                <td>22</td>
                <td>23</td>
                <td>24</td>
            </tr>
            <tr (click)="weekSelected(4)">
                <td>25</td>
                <td>26</td>
                <td>27</td>
                <td>28</td>
                <td>29</td>
                <td>30</td>
                <td>31</td>
            </tr>
        </table>
    </div>




</div>
<div class="cat_1 projects" style="margin-bottom: 10px;">
    <table width="100%">
        <tr>
            <td width="50%">
                <input value="" placeholder="Search For Person" style="box-sizing:border-box;width:100%;padding:5px;" (keyup)="search_name=$event.target.value.toLowerCase()"
                    (click)="$event.target.value='';search_name=''">
            </td>
            <td width="50%">
                <input value="" placeholder="Search For Show/Department" style="box-sizing:border-box;width:100%;padding:5px;" (keyup)="search_project=$event.target.value.toLowerCase()"
                    (click)="$event.target.value='';search_project=''">
            </td>
        </tr>
    </table>
</div>

<!-- Template for Projects -->
<div class="cat_1 projects" *ngFor="let x_1 of timesheet; let i_0 = 'index'" style="margin-bottom: 10px;">
    <div class="cat_1_title">
        <table style="width:100%;">
            <tr>
                <td style="width: 200px;font-size:1.5em;font-weight: 700;">
                    {{ titles[x_1.cat_key]['Title'] }}
                </td>
                <td>
                    <table style="width: 100%;">
                        <tr>
                            <td class="blank">&nbsp;</td>
                            <td *ngFor="let day of days_label" class="day">{{ day }}</td>
                            <td class="sum_approval">&nbsp;</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
    <div class="cat_1_content" *ngIf="x_1.children.length > 0">
        <div *ngFor="let x_2 of x_1.children; let last = last;let first = first; let i_1 = 'index'">
            <div *ngIf="search_project.length == 0 || titles[x_1.cat_key][x_2.cat_key]['Title'].toLowerCase().indexOf(search_project) != -1">
                <div *ngIf="!first">&nbsp;</div>
                <div style="border-bottom:1px #BBB solid;padding-bottom:5px;margin-bottom: 5px;">
                    <table style="width:100%;">
                        <tr>
                            <td style="width: 200px;" class="cat_0_title">
                                {{ titles[x_1.cat_key][x_2.cat_key]['Title'] }}
                            </td>
                            <td>&nbsp;</td>
                        </tr>
                    </table>
                </div>
                <div *ngFor="let x_3 of x_2.children">
                    <div [style.opacity]="(user_focused == x_3.cat_key || !user_focused) ? 1.0 : 0.25">
                        <div *ngIf="search_name.length == 0 || users[x_3.cat_key].FullName_r.toLowerCase().indexOf(search_name) != -1">
                            <div style="position:absolute;margin-left:800px;margin-top:5px;">
                                <div title="Approve" *ngIf="!x_3.rejected" [class]="(x_3.approved) ? 'approval_sel' : 'approval'" (click)="rowApproved($event,x_3)"
                                    (mouseover)="x_3.approval_hover = true;" (mouseout)="x_3.approval_hover = false;">&nbsp;</div>
                                <div title="Reject" *ngIf="!x_3.approved" [class]="(x_3.rejected) ? 'reject_sel' : 'reject'" (click)="rowRejectedConfirm(x_3)"
                                    (mouseover)="x_3.approval_hover = true;x_3.rejected_hover=true;" (mouseout)="x_3.approval_hover = false;x_3.rejected_hover=false;">&nbsp;</div>
                                <div *ngIf="x_3.approved_by" class="approved_by" style="color:rgb(177, 177, 177);display:inline-block;">{{ x_3.approved_by }}</div>
                                <div *ngIf="x_3.rejected_by" class="approved_by" style="color:rgb(177, 177, 177);display:inline-block;">{{ x_3.rejected_by }}</div>
                            </div>
                            <table style="width:100%;" [style.opacity]="(x_3.approved) ? .3 : 1.0" [style.color]="(x_3.rejected) ? '#F00' : default">
                                <tr [style.font-weight]="(x_3.approval_hover) ? 800 : default">
                                    <td style="width: 200px;">
                                        <div class="btn_1" (click)="toggleBreakdown($event,x_3.cat_key, x_3)">{{ users[x_3.cat_key].FullName_r}}</div>
                                    </td>
                                    <td>
                                        <table style="width: 100%;">
                                            <tr [style.font-weight]="(user_focused == x_3.cat_key) ? 800 : default">
                                                <td class="blank" style="padding:5px;">&nbsp;</td>
                                                <td *ngFor="let day_i of days" class="day" [class]="(x_3.ot[day_i]) ? 'ot_bg day' : 'day'">
                                                    <span [style.opacity]="(x_3.sum_hours[day_i] <= 0) ? 0.25 : 1.0">{{ x_3.sum_hours[day_i] }}</span>
                                                </td>
                                                <td class="sum_approval">
                                                    <span style="font-weight:700">{{x_3.sum_hours[1] + x_3.sum_hours[2] + x_3.sum_hours[3] + x_3.sum_hours[4]
                                                        + x_3.sum_hours[5] + x_3.sum_hours[6] + x_3.sum_hours[0] | number
                                                        : '1.2-2'}}</span>
                                                    <span style="opacity:0.25;">/{{users[x_3.cat_key].Data.TotalHours| number : '1.2-2'}}</span>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                            <div *ngIf="x_3.breakdown_show" style="background-color:#BBB;">

                                <div *ngFor="let b_1 of timesheet_by_user[x_3.cat_key]">

                                    <div style="font-weight:700;font-size:1.2em;">
                                        &nbsp;{{titles[b_1.cat_key]['Title']}}
                                    </div>

                                    <div *ngFor="let b_2 of b_1.children">
                                        <div style="font-size:1em;font-weight:700;">&nbsp;{{titles[b_1.cat_key][b_2.cat_key]['Title']}}</div>

                                        <div *ngFor="let b_3 of b_2.children">

                                            <div *ngIf="b_3.hours">
                                                <div style="position:absolute;margin-left:800px;margin-top:7px;">
                                                    <div [class]="'note_sel_sm'" (mouseover)="b_3.showNote = true;" (mouseout)="b_3.showNote = false;">&nbsp;</div>
                                                </div>
                                                <table style="width:100%;" [style.opacity]="(x_3.approved) ? .3 : 1.0" [style.color]="(x_3.rejected) ? '#F00' : default">
                                                    <tr [style.font-weight]="(x_3.approval_hover) ? 800 : default">
                                                        <td style="width: 200px;">
                                                            <div>&nbsp;&nbsp;{{titles[b_1.cat_key][b_2.cat_key][b_3.cat_key]['Title']}}</div>
                                                        </td>
                                                        <td>
                                                            <table style="width: 100%;">
                                                                <tr>
                                                                    <td class="blank" style="padding:5px;">&nbsp;</td>
                                                                    <td *ngFor="let day_i of days" class="day" [class]="(b_2.ot[day_i]) ? 'ot_bg day' : 'day'">
                                                                        <span [style.opacity]="(b_3.hours[day_i] <= 0) ? 0.25 : 1.0">{{ b_3.hours[day_i] }}</span>
                                                                    </td>
                                                                    <td class="sum_approval">
                                                                        <span style="font-weight:700">{{b_3.hours[1] + b_3.hours[2] + b_3.hours[3] + b_3.hours[4]
                                                                            + b_3.hours[5] + b_3.hours[6] + b_3.hours[0]
                                                                            | number : '1.2-2'}}</span>
                                                                        <span style="opacity:0.25;">/{{users[x_3.cat_key].Data.TotalHours| number : '1.2-2'}}</span>
                                                                    </td>
                                                                </tr>
                                                            </table>                                                            
                                                        </td>
                                                    </tr>
                                                </table>
                                                <div *ngIf="b_3.showNote" class="note_text">A note entered by the artist would display here for the approver
                                                        to see. If there is no note then the 'note' icon will not
                                                        be present on the screen for the specific row of data.{{
                                                        b_3.note }}</div>
                                            </div>
                                            <div *ngIf="!b_3.hours">
                                                <div *ngFor="let b_4 of b_3.children">
                                                    &nbsp;&nbsp;{{titles[b_1.cat_key][b_2.cat_key][b_3.cat_key]['Title']}} : {{titles[b_1.cat_key][b_2.cat_key][b_3.cat_key][b_4.cat_key]['Title']}}
                                                    <div *ngFor="let b_5 of b_4.children">

                                                        <div style="position:absolute;margin-left:800px;margin-top:7px;">
                                                            <div [class]="'note_sel_sm'" (mouseover)="b_5.showNote = true" (mouseout)="b_5.showNote = false">&nbsp;</div>
                                                        </div>
                                                        <table style="width:100%;" [style.opacity]="(x_3.approved) ? .3 : 1.0" [style.color]="(x_3.rejected) ? '#F00' : default">
                                                            <tr [style.font-weight]="(x_3.approval_hover) ? 800 : default">
                                                                <td style="width: 200px;">
                                                                    <div>&nbsp;&nbsp;&nbsp;{{titles[b_1.cat_key][b_2.cat_key][b_3.cat_key][b_4.cat_key][b_5.cat_key]['Title']}}</div>
                                                                </td>
                                                                <td>
                                                                    <table style="width: 100%;">
                                                                        <tr>
                                                                            <td class="blank" style="padding:5px;">&nbsp;</td>
                                                                            <td *ngFor="let day_i of days" class="day" [class]="(b_2.ot[day_i]) ? 'ot_bg day' : 'day'">
                                                                                <span [style.opacity]="(b_5.hours[day_i] <= 0) ? 0.25 : 1.0">{{ b_5.hours[day_i] }}</span>
                                                                            </td>
                                                                            <td class="sum_approval">
                                                                                <span style="font-weight:700">{{b_5.hours[1] + b_5.hours[2] + b_5.hours[3]
                                                                                    + b_5.hours[4] + b_5.hours[5] + b_5.hours[6]
                                                                                    + b_5.hours[0] | number : '1.2-2'}}</span>
                                                                                <span style="opacity:0.25;">/{{users[x_3.cat_key].Data.TotalHours| number
                                                                                    : '1.2-2'}}</span>
                                                                            </td>
                                                                        </tr>
                                                                    </table>                                                                    
                                                                </td>
                                                            </tr>
                                                        </table>
                                                        <div *ngIf="b_5.showNote" class="note_text">A note entered by the artist would display here for the
                                                            approver to see. If there is no note then the 'note'
                                                            icon will not be present on the screen for the specific
                                                            row of data.{{ b_4.note }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding:3px;">
                                    Totals will go here...
                                </div>
                            </div>
                        </div>
                        <div *ngIf="x_3.rejected && (x_3.rejected_note || x_3.rejected_note_department) && x_3.rejected_hover">
                            <div *ngIf="x_3.rejected_note" class="rejected_note note_text">
                                <div class="rejected_title">Rejection Note - To Artist</div>
                                <div class="rejected_text">{{ x_3.rejected_note }}</div>
                            </div>                            
                            <div *ngIf="x_3.rejected_note_department" class="rejected_note note_text">
                                <div class="rejected_title">Rejection Note - To Department</div>
                                <div class="rejected_text">{{ x_3.rejected_note_department }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>